{"ast":null,"code":"import _objectSpread from\"C:/Users/Ghost/Desktop/homework/Redux_Store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/Ghost/Desktop/homework/Redux_Store/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{Link,useParams}from\"react-router-dom\";import{useQuery}from\"@apollo/client\";import Cart from\"../components/Cart\";import{useStoreContext}from\"../utils/GlobalState\";import{REMOVE_FROM_CART,UPDATE_CART_QUANTITY,ADD_TO_CART,UPDATE_PRODUCTS}from\"../utils/actions\";import{QUERY_PRODUCTS}from\"../utils/queries\";import{idbPromise}from\"../utils/helpers\";import spinner from\"../assets/spinner.gif\";import{useSelector,useDispatch}from\"react-redux\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Detail(){// const [state, dispatch] = useStoreContext();\nvar state=useSelector(function(state){return state;});var dispatch=useDispatch();var _useParams=useParams(),id=_useParams.id;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),currentProduct=_useState2[0],setCurrentProduct=_useState2[1];var _useQuery=useQuery(QUERY_PRODUCTS),loading=_useQuery.loading,data=_useQuery.data;var products=state.products,cart=state.cart;useEffect(function(){// already in global store\nif(products.length){setCurrentProduct(products.find(function(product){return product._id===id;}));}// retrieved from server\nelse if(data){dispatch({type:UPDATE_PRODUCTS,products:data.products});data.products.forEach(function(product){idbPromise(\"products\",\"put\",product);});}// get cache from idb\nelse if(!loading){idbPromise(\"products\",\"get\").then(function(indexedProducts){dispatch({type:UPDATE_PRODUCTS,products:indexedProducts});});}},[products,data,loading,dispatch,id]);var addToCart=function addToCart(){var itemInCart=cart.find(function(cartItem){return cartItem._id===id;});if(itemInCart){dispatch({type:UPDATE_CART_QUANTITY,_id:id,purchaseQuantity:parseInt(itemInCart.purchaseQuantity)+1});idbPromise(\"cart\",\"put\",_objectSpread(_objectSpread({},itemInCart),{},{purchaseQuantity:parseInt(itemInCart.purchaseQuantity)+1}));}else{dispatch({type:ADD_TO_CART,product:_objectSpread(_objectSpread({},currentProduct),{},{purchaseQuantity:1})});idbPromise(\"cart\",\"put\",_objectSpread(_objectSpread({},currentProduct),{},{purchaseQuantity:1}));}};var removeFromCart=function removeFromCart(){dispatch({type:REMOVE_FROM_CART,_id:currentProduct._id});idbPromise(\"cart\",\"delete\",_objectSpread({},currentProduct));};return/*#__PURE__*/_jsxs(_Fragment,{children:[currentProduct&&cart?/*#__PURE__*/_jsxs(\"div\",{className:\"container my-1\",children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"\\u2190 Back to Products\"}),/*#__PURE__*/_jsx(\"h2\",{children:currentProduct.name}),/*#__PURE__*/_jsx(\"p\",{children:currentProduct.description}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Price:\"}),\"$\",currentProduct.price,\" \",/*#__PURE__*/_jsx(\"button\",{onClick:addToCart,children:\"Add to Cart\"}),/*#__PURE__*/_jsx(\"button\",{disabled:!cart.find(function(p){return p._id===currentProduct._id;}),onClick:removeFromCart,children:\"Remove from Cart\"})]}),/*#__PURE__*/_jsx(\"img\",{src:\"/images/\".concat(currentProduct.image),alt:currentProduct.name})]}):null,loading?/*#__PURE__*/_jsx(\"img\",{src:spinner,alt:\"loading\"}):null,/*#__PURE__*/_jsx(Cart,{})]});}export default Detail;","map":{"version":3,"sources":["C:/Users/Ghost/Desktop/homework/Redux_Store/client/src/pages/Detail.js"],"names":["React","useEffect","useState","Link","useParams","useQuery","Cart","useStoreContext","REMOVE_FROM_CART","UPDATE_CART_QUANTITY","ADD_TO_CART","UPDATE_PRODUCTS","QUERY_PRODUCTS","idbPromise","spinner","useSelector","useDispatch","Detail","state","dispatch","id","currentProduct","setCurrentProduct","loading","data","products","cart","length","find","product","_id","type","forEach","then","indexedProducts","addToCart","itemInCart","cartItem","purchaseQuantity","parseInt","removeFromCart","name","description","price","p","image"],"mappings":"iVAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,IAAT,CAAeC,SAAf,KAAgC,kBAAhC,CACA,OAASC,QAAT,KAAyB,gBAAzB,CAEA,MAAOC,CAAAA,IAAP,KAAiB,oBAAjB,CACA,OAASC,eAAT,KAAgC,sBAAhC,CACA,OACEC,gBADF,CAEEC,oBAFF,CAGEC,WAHF,CAIEC,eAJF,KAKO,kBALP,CAMA,OAASC,cAAT,KAA+B,kBAA/B,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,OAAP,KAAoB,uBAApB,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,C,6IAEA,QAASC,CAAAA,MAAT,EAAkB,CAChB;AACA,GAAMC,CAAAA,KAAK,CAAGH,WAAW,CAAC,SAACG,KAAD,QAAWA,CAAAA,KAAX,EAAD,CAAzB,CACA,GAAMC,CAAAA,QAAQ,CAAGH,WAAW,EAA5B,CACA,eAAeZ,SAAS,EAAxB,CAAQgB,EAAR,YAAQA,EAAR,CAEA,cAA4ClB,QAAQ,CAAC,EAAD,CAApD,wCAAOmB,cAAP,eAAuBC,iBAAvB,eAEA,cAA0BjB,QAAQ,CAACO,cAAD,CAAlC,CAAQW,OAAR,WAAQA,OAAR,CAAiBC,IAAjB,WAAiBA,IAAjB,CAEA,GAAQC,CAAAA,QAAR,CAA2BP,KAA3B,CAAQO,QAAR,CAAkBC,IAAlB,CAA2BR,KAA3B,CAAkBQ,IAAlB,CAEAzB,SAAS,CAAC,UAAM,CACd;AACA,GAAIwB,QAAQ,CAACE,MAAb,CAAqB,CACnBL,iBAAiB,CAACG,QAAQ,CAACG,IAAT,CAAc,SAACC,OAAD,QAAaA,CAAAA,OAAO,CAACC,GAAR,GAAgBV,EAA7B,EAAd,CAAD,CAAjB,CACD,CACD;AAHA,IAIK,IAAII,IAAJ,CAAU,CACbL,QAAQ,CAAC,CACPY,IAAI,CAAEpB,eADC,CAEPc,QAAQ,CAAED,IAAI,CAACC,QAFR,CAAD,CAAR,CAKAD,IAAI,CAACC,QAAL,CAAcO,OAAd,CAAsB,SAACH,OAAD,CAAa,CACjChB,UAAU,CAAC,UAAD,CAAa,KAAb,CAAoBgB,OAApB,CAAV,CACD,CAFD,EAGD,CACD;AAVK,IAWA,IAAI,CAACN,OAAL,CAAc,CACjBV,UAAU,CAAC,UAAD,CAAa,KAAb,CAAV,CAA8BoB,IAA9B,CAAmC,SAACC,eAAD,CAAqB,CACtDf,QAAQ,CAAC,CACPY,IAAI,CAAEpB,eADC,CAEPc,QAAQ,CAAES,eAFH,CAAD,CAAR,CAID,CALD,EAMD,CACF,CAzBQ,CAyBN,CAACT,QAAD,CAAWD,IAAX,CAAiBD,OAAjB,CAA0BJ,QAA1B,CAAoCC,EAApC,CAzBM,CAAT,CA2BA,GAAMe,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACtB,GAAMC,CAAAA,UAAU,CAAGV,IAAI,CAACE,IAAL,CAAU,SAACS,QAAD,QAAcA,CAAAA,QAAQ,CAACP,GAAT,GAAiBV,EAA/B,EAAV,CAAnB,CACA,GAAIgB,UAAJ,CAAgB,CACdjB,QAAQ,CAAC,CACPY,IAAI,CAAEtB,oBADC,CAEPqB,GAAG,CAAEV,EAFE,CAGPkB,gBAAgB,CAAEC,QAAQ,CAACH,UAAU,CAACE,gBAAZ,CAAR,CAAwC,CAHnD,CAAD,CAAR,CAKAzB,UAAU,CAAC,MAAD,CAAS,KAAT,gCACLuB,UADK,MAERE,gBAAgB,CAAEC,QAAQ,CAACH,UAAU,CAACE,gBAAZ,CAAR,CAAwC,CAFlD,GAAV,CAID,CAVD,IAUO,CACLnB,QAAQ,CAAC,CACPY,IAAI,CAAErB,WADC,CAEPmB,OAAO,gCAAOR,cAAP,MAAuBiB,gBAAgB,CAAE,CAAzC,EAFA,CAAD,CAAR,CAIAzB,UAAU,CAAC,MAAD,CAAS,KAAT,gCAAqBQ,cAArB,MAAqCiB,gBAAgB,CAAE,CAAvD,GAAV,CACD,CACF,CAnBD,CAqBA,GAAME,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CAC3BrB,QAAQ,CAAC,CACPY,IAAI,CAAEvB,gBADC,CAEPsB,GAAG,CAAET,cAAc,CAACS,GAFb,CAAD,CAAR,CAKAjB,UAAU,CAAC,MAAD,CAAS,QAAT,kBAAwBQ,cAAxB,EAAV,CACD,CAPD,CASA,mBACE,2BACGA,cAAc,EAAIK,IAAlB,cACC,aAAK,SAAS,CAAC,gBAAf,wBACE,KAAC,IAAD,EAAM,EAAE,CAAC,GAAT,qCADF,cAGE,oBAAKL,cAAc,CAACoB,IAApB,EAHF,cAKE,mBAAIpB,cAAc,CAACqB,WAAnB,EALF,cAOE,kCACE,kCADF,KAC2BrB,cAAc,CAACsB,KAD1C,CACiD,GADjD,cAEE,eAAQ,OAAO,CAAER,SAAjB,yBAFF,cAGE,eACE,QAAQ,CAAE,CAACT,IAAI,CAACE,IAAL,CAAU,SAACgB,CAAD,QAAOA,CAAAA,CAAC,CAACd,GAAF,GAAUT,cAAc,CAACS,GAAhC,EAAV,CADb,CAEE,OAAO,CAAEU,cAFX,8BAHF,GAPF,cAkBE,YACE,GAAG,mBAAanB,cAAc,CAACwB,KAA5B,CADL,CAEE,GAAG,CAAExB,cAAc,CAACoB,IAFtB,EAlBF,GADD,CAwBG,IAzBN,CA0BGlB,OAAO,cAAG,YAAK,GAAG,CAAET,OAAV,CAAmB,GAAG,CAAC,SAAvB,EAAH,CAAyC,IA1BnD,cA2BE,KAAC,IAAD,IA3BF,GADF,CA+BD,CAED,cAAeG,CAAAA,MAAf","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { useQuery } from \"@apollo/client\";\n\nimport Cart from \"../components/Cart\";\nimport { useStoreContext } from \"../utils/GlobalState\";\nimport {\n  REMOVE_FROM_CART,\n  UPDATE_CART_QUANTITY,\n  ADD_TO_CART,\n  UPDATE_PRODUCTS,\n} from \"../utils/actions\";\nimport { QUERY_PRODUCTS } from \"../utils/queries\";\nimport { idbPromise } from \"../utils/helpers\";\nimport spinner from \"../assets/spinner.gif\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\nfunction Detail() {\n  // const [state, dispatch] = useStoreContext();\n  const state = useSelector((state) => state);\n  const dispatch = useDispatch();\n  const { id } = useParams();\n\n  const [currentProduct, setCurrentProduct] = useState({});\n\n  const { loading, data } = useQuery(QUERY_PRODUCTS);\n\n  const { products, cart } = state;\n\n  useEffect(() => {\n    // already in global store\n    if (products.length) {\n      setCurrentProduct(products.find((product) => product._id === id));\n    }\n    // retrieved from server\n    else if (data) {\n      dispatch({\n        type: UPDATE_PRODUCTS,\n        products: data.products,\n      });\n\n      data.products.forEach((product) => {\n        idbPromise(\"products\", \"put\", product);\n      });\n    }\n    // get cache from idb\n    else if (!loading) {\n      idbPromise(\"products\", \"get\").then((indexedProducts) => {\n        dispatch({\n          type: UPDATE_PRODUCTS,\n          products: indexedProducts,\n        });\n      });\n    }\n  }, [products, data, loading, dispatch, id]);\n\n  const addToCart = () => {\n    const itemInCart = cart.find((cartItem) => cartItem._id === id);\n    if (itemInCart) {\n      dispatch({\n        type: UPDATE_CART_QUANTITY,\n        _id: id,\n        purchaseQuantity: parseInt(itemInCart.purchaseQuantity) + 1,\n      });\n      idbPromise(\"cart\", \"put\", {\n        ...itemInCart,\n        purchaseQuantity: parseInt(itemInCart.purchaseQuantity) + 1,\n      });\n    } else {\n      dispatch({\n        type: ADD_TO_CART,\n        product: { ...currentProduct, purchaseQuantity: 1 },\n      });\n      idbPromise(\"cart\", \"put\", { ...currentProduct, purchaseQuantity: 1 });\n    }\n  };\n\n  const removeFromCart = () => {\n    dispatch({\n      type: REMOVE_FROM_CART,\n      _id: currentProduct._id,\n    });\n\n    idbPromise(\"cart\", \"delete\", { ...currentProduct });\n  };\n\n  return (\n    <>\n      {currentProduct && cart ? (\n        <div className=\"container my-1\">\n          <Link to=\"/\">‚Üê Back to Products</Link>\n\n          <h2>{currentProduct.name}</h2>\n\n          <p>{currentProduct.description}</p>\n\n          <p>\n            <strong>Price:</strong>${currentProduct.price}{\" \"}\n            <button onClick={addToCart}>Add to Cart</button>\n            <button\n              disabled={!cart.find((p) => p._id === currentProduct._id)}\n              onClick={removeFromCart}\n            >\n              Remove from Cart\n            </button>\n          </p>\n\n          <img\n            src={`/images/${currentProduct.image}`}\n            alt={currentProduct.name}\n          />\n        </div>\n      ) : null}\n      {loading ? <img src={spinner} alt=\"loading\" /> : null}\n      <Cart />\n    </>\n  );\n}\n\nexport default Detail;\n"]},"metadata":{},"sourceType":"module"}